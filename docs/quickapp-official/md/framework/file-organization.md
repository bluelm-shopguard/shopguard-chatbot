
# 快应用文件组织与资源管理

本篇将介绍快应用的项目文件结构、文件存储分区、URI 规范以及资源文件的访问规则。

---

## 1. 应用资源与目录结构

一个标准的快应用项目主要由一个核心配置文件 `manifest.json`、一个全局逻辑文件 `app.ux` 以及多个页面/组件 `.ux` 文件组成。

一个典型的项目目录结构示例如下：

```
/ (应用根目录)
├── manifest.json       # 应用配置文件
├── app.ux              # 全局逻辑和公共资源
├── Page1/
│   └── page1.ux        # 页面1
├── Page2/
│   └── page2.ux        # 页面2
└── Common/
    ├── ComponentA.ux   # 公共组件A
    ├── ComponentB.ux   # 公共组件B
    └── xxx.png         # 公共图片资源
```

-   **`Common/`**: 建议用于存放项目内公用的资源，如自定义组件、公共脚本、图片等。
-   **`Page1/`, `Page2/`**: 各页面目录，用于存放页面私有的资源。

---

## 2. 文件存储分区

在快应用平台中，文件根据其用途和生命周期被存储在不同的分区。

| 分区 | 说明 | 特性 |
| :--- | :--- | :--- |
| **`Cache`** | 用于存储可被随时删除的缓存文件。例如，通过 `fetch` API 下载的文件默认存放在此。 | 存储空间不足时，系统可能会自动清理此分区的文件。 |
| **`Files`** | 用于存储应用的永久性小文件。 | 此分区文件由应用自行管理，系统不会主动删除。 |
| **`Mass`** | 用于存储体积较大的文件，如视频等。 | 此分区不保证一直可用。 |
| **`Temp`** | 用于存放由特定 API（如 `media.pickVideo`）从外部引入的临时文件。 | **只读**。应用重启后无法再次访问，需要通过 API 重新获取。 |

此外，应用包内的资源（如图片、脚本等）本身也被视为一个特殊的**只读分区**。

---

## 3. URI (统一资源标识符)

URI 用于在组件和接口中定位和访问应用资源及存储分区中的文件。

| 资源类型 | URI 前缀/格式 | 只读 | 示例 |
| :--- | :--- | :--- | :--- |
| 应用包资源 | `/path` | 是 | `/Common/logo.png` |
| Cache 分区 | `internal://cache/path` | 否 | `internal://cache/fetch-123456.tmp` |
| Files 分区 | `internal://files/path` | 否 | `internal://files/user/avatar.jpg` |
| Mass 分区 | `internal://mass/path` | 否 | `internal://mass/videos/intro.mp4` |
| Temp 分区 | `internal://tmp/path` | 是 | `internal://tmp/xyz-abc` (由系统生成) |

**URI 规范**:
-   **允许字符**: `0-9`, `a-z`, `A-Z`, `_`, `-`, `.`, `/`, `%`, `:`。
-   **禁止字符**: 不能包含 `..` 以防止路径穿越。
-   **`internal://`**: 这个协议头表示访问的是**应用私有文件**。框架会自动将其映射到当前应用的私有存储空间，开发者无需关心应用的具体包名。

---

## 4. 资源和文件访问规则

应用包内的资源路径分为**绝对路径**和**相对路径**。

-   **绝对路径**: 以 `/` 开头，从项目根目录开始计算，如 `/Common/logo.png`。
-   **相对路径**: 不以 `/` 开头，相对于当前文件所在目录进行计算，如 `./logo.png` 或 `../images/logo.png`。

访问规则根据文件类型有所不同：

1.  **在代码文件中导入其他代码文件** (`.js`, `.css`, `.ux`)
    -   **规则**: 必须使用**相对路径**。
    -   **示例**: `import MyComponent from '../Common/ComponentA.ux';`

2.  **在代码文件中引用资源文件** (图片、视频等)
    -   **规则**: 通常情况下使用**相对路径**。
    -   **示例**: `<image src="./logo.png"></image>`

3.  **被导入文件中引用资源文件（特殊情况）**
    -   **场景**: 当一个文件A（如 `a.css` 或 `a.ux`）被另一个文件B（如 `b.ux`）导入时，文件A的编译上下文会变为文件B的路径。
    -   **规则**:
        -   如果 A 和 B 在**同一目录**，A 中可以使用**相对路径**引用资源。
        -   如果 A 和 B 在**不同目录**，A 中必须使用**绝对路径**引用资源，否则编译后路径会出错。
    -   **示例**: `b.ux` 导入了 `../Common/a.ux`。此时 `a.ux` 如果要引用 `Common` 目录下的 `logo.png`，必须写成绝对路径 `/Common/logo.png`。

4.  **在 CSS 中引用资源文件**
    -   **规则**: 与标准 Web 开发一致，使用 `url()` 语法。
    -   **示例**: `.bg { background-image: url(/Common/logo.png); }`
