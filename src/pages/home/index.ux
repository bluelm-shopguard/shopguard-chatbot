<template>
  <div class="page">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-button" onclick="openSidebar">
        <text class="header-icon">☰</text>
      </div>
      <text class="chat-header-title">ShopGuard AI</text>
      <div class="header-button" onclick="startNewChat">
        <text class="header-icon">+</text>
      </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="chat-content">
      <div class="chat-welcome">
        <div class="logo-container">
          <!-- TODO use logo icon instead of text -->
          <text class="logo-text">SG</text>
        </div>
        <text class="welcome-title">蓝心购物防诈骗助手</text>
        <div class="welcome-message-container">
          <text class="welcome-message">遇到可疑商品、卖家或付款方式？随时发给我分析。无论是商品截图、链接还是聊天记录，我都会帮你识别风险，提供明确的"虚假诈骗风险星级"和建议，让我们一起安心购物不踩坑！</text>
        </div>
      </div>
    </div>
    
    <!-- Input Area - Redesigned to match webapp -->
    <div class="chat-input-area">
      <div class="input-area-toolbar">
        <div class="toolbar-button" onclick="handleImageUpload">
          <text class="toolbar-icon">🖼</text>
          <text class="toolbar-text">图片</text>
        </div>
        <div class="toolbar-button" onclick="handleWebSearch">
          <text class="toolbar-icon">🔍</text>
          <text class="toolbar-text">搜索</text>
        </div>
      </div>
      
      <div class="input-area-wrapper">
        <input class="text-input" type="text" placeholder="发消息给我分析一下..." onchange="handleInputChange"/>
        <div class="send-button" onclick="sendMessage">
          <text class="send-icon">↑</text>
        </div>
      </div>
    </div>
    
    <!-- Sidebar Component -->
    <div class="sidebar-overlay" show="{{sidebarActive}}" onclick="closeSidebar">
    </div>
    
    <div class="sidebar" style="transform: {{sidebarActive ? 'translateX(0)' : 'translateX(-100%)'}}">
      <div class="sidebar-header">
        <text class="sidebar-title">历史对话</text>
        <div class="header-button close-button" onclick="closeSidebar">
          <text class="header-icon">✕</text>
        </div>
      </div>
      
      <div class="sidebar-content">
        <!-- Conversation history will be implemented later -->
        <text class="sidebar-empty-text">暂无历史对话</text>
      </div>
      
      <div class="sidebar-footer">
        <div class="account-info">
          <div class="account-avatar">
            <text class="avatar-text">👤</text>
          </div>
          <text class="account-name">用户</text>
        </div>
        <div class="settings-button" onclick="navigateToSettings">
          <text class="settings-icon">⚙️</text>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data: {
    message: '',
    isProcessingMessage: false,
    currentImageData: null,
    sidebarActive: false
  },
  handleInputChange: function(e) {
    this.message = e.value
  },
  openSidebar: function() {
    // In the future, this will activate sidebar
    this.$app.$def.showToast('侧边栏功能即将推出')
    this.sidebarActive = true
  },
  closeSidebar: function() {
    this.sidebarActive = false
  },
  startNewChat: function() {
    this.message = ''
    this.currentImageData = null
    this.$app.$def.showToast('开始新的对话')
  },
  handleImageUpload: function() {
    this.$app.$def.showToast('图片上传功能即将推出')
  },
  handleWebSearch: function() {
    this.$app.$def.showToast('网页搜索功能即将推出')
  },
  navigateToSettings: function() {
    // Navigate to settings page
    const router = require('@system.router')
    router.push({
      uri: 'pages/settings'
    })
  },
  sendMessage: function() {
    if (!this.message.trim() && !this.currentImageData) {
      return
    }
    
    if (this.isProcessingMessage) {
      return
    }
    
    this.$app.$def.showToast('消息发送功能即将推出')
    this.message = ''
  }
}
</script>

<style lang="less">
@import '../../common/styles/theme.less';

.page {
  flex-direction: column;
  width: 100%;
  height: 100%;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
  background-color: @background-color;
}

/* Header Styles */
.chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background-color: @component-background;
  border-bottom: 1px solid @border-color;
}

.chat-header-title {
  font-size: @font-size-xlarge;
  font-weight: bold;
  color: @text-color-primary;
}

.header-button {
  padding: 10px;
  border-radius: 8px;
  background: none;
}

.header-icon {
  width: 28px;
  height: 28px;
  text-align: center;
  font-size: @font-size-large;
  color: @text-color-tertiary;
}

/* Content Area Styles */
.chat-content {
  flex: 1;
  overflow-y: scroll;
  padding: 20px 16px;
  display: flex;
  flex-direction: column;
}

.chat-welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px;
  margin: auto;
  width: 100%;
  max-width: 600px;
}

.logo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100px;
  height: 100px;
  background-color: @primary-color;
  border-radius: 50px;
  margin-bottom: 20px;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
}

.logo-text {
  font-size: @font-size-xxlarge;
  font-weight: bold;
  color: @text-color-inverse;
  text-align: center;
}

.welcome-title {
  font-size: @font-size-xlarge;
  font-weight: bold;
  color: @primary-color;
  margin-bottom: 12px;
}

.welcome-message-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  padding: 16px 0;
  margin-top: 8px;
}

.welcome-message {
  font-size: @font-size-medium;
  color: @text-color-secondary;
  text-align: center;
  height: 140px;
  margin-bottom: 10px;
  width: 100%;
}

/* Input Area Styles - Redesigned to match webapp */
.chat-input-area {
  padding: 16px 20px 20px 20px;
  border-top: 1px solid @border-color;
  background-color: @component-background;
}

.input-area-toolbar {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
  padding: 0 4px;
}

.toolbar-button {
  display: flex;
  align-items: center;
  padding: 10px 12px;
  border-radius: 8px;
  background-color: @background-color;
  border: 1px solid @border-color;
}

.toolbar-icon {
  width: 28px;
  height: 28px;
  margin-right: 8px;
  font-size: @font-size-medium;
  color: @text-color-tertiary;
}

.toolbar-text {
  font-size: @font-size-small;
  color: @text-color-tertiary;
}

.input-area-wrapper {
  display: flex;
  align-items: center;
  gap: 16px;
  width: 100%;
}

.text-input {
  flex: 1;
  min-height: 56px;
  max-height: 120px;
  padding: 16px;
  border-radius: 16px;
  font-size: @font-size-small;
  border: 1px solid @border-color;
  background-color: #f9fafb;
  color: @text-color-primary;
}

.send-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 56px;
  height: 56px;
  border-radius: 28px;
  background-color: @primary-color;
  flex-shrink: 0;
}

.send-icon {
  color: @text-color-inverse;
  font-size: @font-size-large;
  font-weight: bold;
}

/* Sidebar Styles */
.sidebar-overlay {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 998;
}

/* Sidebar Component */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 300px;
  height: 100%;
  z-index: 999;
  transition-property: transform;
  transition-duration: 300ms;
  display: flex;
  flex-direction: column;
  background-color: @component-background;
}

.sidebar-header {
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid @border-color;
}

.sidebar-title {
  font-size: @font-size-medium;
  font-weight: bold;
  color: @text-color-primary;
}

.close-button {
  padding: 8px;
  border-radius: 8px;
}

.sidebar-content {
  flex: 1;
  overflow-y: scroll;
  padding: 16px;
  display: flex;
  flex-direction: column;
}

.sidebar-empty-text {
  font-size: @font-size-xsmall;
  text-align: center;
  margin-top: 50px;
  color: @text-color-tertiary;
}

.sidebar-footer {
  padding: 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-top: 1px solid @border-color;
}

.account-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.account-avatar {
  width: 40px;
  height: 40px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: @background-color;
}

.avatar-text {
  font-size: @font-size-small;
}

.account-name {
  font-size: @font-size-xsmall;
  font-weight: bold;
  color: @text-color-primary;
}

.settings-button {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.settings-icon {
  font-size: @font-size-medium;
}
</style>
